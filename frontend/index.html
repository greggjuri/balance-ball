<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Balance Ball - Tilt Game</title>
    <link href="https://fonts.googleapis.com/css2?family=Russo+One&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="header-buttons">
        <button class="header-btn leaderboard-btn" onclick="openLeaderboard()">üèÜ</button>
        <button class="header-btn settings-btn" onclick="openSettings()">‚öô</button>
        <button class="header-btn help-btn" onclick="openHelp()">?</button>
    </div>
    
    <!-- Help Overlay -->
    <div class="help-overlay" id="helpOverlay" onclick="closeHelpOnOverlay(event)">
        <div class="help-panel">
            <h2>? HOW TO PLAY</h2>
            
            <div class="help-section">
                <h3>Goal</h3>
                <p>Keep the ball balanced on the platform while avoiding black holes and collecting score balls!</p>
            </div>
            
            <div class="help-section">
                <h3>Controls</h3>
                <div class="help-controls">
                    <div class="help-control-group">
                        <h4>Tilt Platform</h4>
                        <div class="help-key-row">
                            <span class="help-key">A</span>
                            <span>Tilt Left</span>
                        </div>
                        <div class="help-key-row">
                            <span class="help-key">Z</span>
                            <span>Tilt Right</span>
                        </div>
                    </div>
                    <div class="help-control-group">
                        <h4>Move Platform</h4>
                        <div class="help-key-row">
                            <span class="help-key">N</span>
                            <span>Move Left</span>
                        </div>
                        <div class="help-key-row">
                            <span class="help-key">M</span>
                            <span>Move Right</span>
                        </div>
                    </div>
                    <div class="help-control-group">
                        <h4>Other</h4>
                        <div class="help-key-row">
                            <span class="help-key">P</span>
                            <span>Pause Game</span>
                        </div>
                        <div class="help-key-row">
                            <span class="help-key">SPACE</span>
                            <span>Restart (when game over)</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="help-section">
                <h3>Scoring</h3>
                <p>Collect score balls to earn points. Smaller balls move faster but are worth more!</p>
                <div class="help-score-balls">
                    <div class="help-ball gold">1 pt</div>
                    <div class="help-ball green">3 pts</div>
                    <div class="help-ball purple">5 pts</div>
                </div>
            </div>
            
            <div class="help-section">
                <h3>Tips</h3>
                <ul class="help-tips">
                    <li>The platform auto-levels when you release the tilt keys</li>
                    <li>Black holes speed up every 20 points</li>
                    <li>Grab power-ups for special abilities</li>
                    <li>Watch out for power-downs (red glow)!</li>
                </ul>
            </div>
            
            <button class="help-close" onclick="closeHelp()">GOT IT!</button>
        </div>
    </div>
    
    <!-- Leaderboard Overlay -->
    <div class="leaderboard-overlay" id="leaderboardOverlay" onclick="closeLeaderboardOnOverlay(event)">
        <div class="leaderboard-panel">
            <h2>üèÜ LEADERBOARD</h2>
            <div class="leaderboard-table-wrapper">
                <table class="leaderboard-table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Name</th>
                            <th>Score</th>
                            <th>Date</th>
                            <th>Message</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboardBody">
                        <tr><td colspan="5" class="loading">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
            <button class="leaderboard-close" onclick="closeLeaderboard()">CLOSE</button>
        </div>
    </div>
    
    <!-- Settings Overlay -->
    <div class="settings-overlay" id="settingsOverlay" onclick="closeSettingsOnOverlay(event)">
        <div class="settings-panel">
            <h2>‚öô SETTINGS</h2>
            
            <div class="setting-group">
                <h3>Ball Color</h3>
                <div class="setting-options">
                    <div class="setting-option" data-setting="ballColor" data-value="white" onclick="selectOption(this)">
                        <div class="color-preview white"></div>
                        White
                    </div>
                    <div class="setting-option selected" data-setting="ballColor" data-value="red" onclick="selectOption(this)">
                        <div class="color-preview red"></div>
                        Red
                    </div>
                    <div class="setting-option" data-setting="ballColor" data-value="black" onclick="selectOption(this)">
                        <div class="color-preview black"></div>
                        Black
                    </div>
                </div>
            </div>

            <div class="setting-group">
                <h3>Platform Width</h3>
                <div class="setting-options">
                    <div class="setting-option" data-setting="platformWidth" data-value="short" onclick="selectOption(this)">
                        Short
                    </div>
                    <div class="setting-option selected" data-setting="platformWidth" data-value="normal" onclick="selectOption(this)">
                        Normal
                    </div>
                    <div class="setting-option" data-setting="platformWidth" data-value="wide" onclick="selectOption(this)">
                        Wide
                    </div>
                </div>
            </div>

            <hr class="settings-divider">

            <div class="setting-group">
                <h3>Audio</h3>
                <div class="toggle-option">
                    <div class="audio-info">
                        <div class="audio-icon icon-music"></div>
                        <span class="toggle-label">Music (by <a href="https://www.youtube.com/@boilingtheocean9441" target="_blank" class="music-credit">Boiling The Ocean</a>)</span>
                    </div>
                    <div class="toggle-switch" id="musicToggle" onclick="toggleMusic()"></div>
                </div>
            </div>

            <hr class="settings-divider">

            <div class="setting-group">
                <h3>Power-Ups</h3>
                <div class="toggle-option powerup-option">
                    <div class="powerup-info">
                        <div class="powerup-icon icon-shield"></div>
                        <div class="powerup-text">
                            <span class="toggle-label">Shield</span>
                            <span class="powerup-desc">Immunity from black holes for 12 seconds</span>
                        </div>
                    </div>
                    <div class="toggle-switch on" id="shieldToggle" onclick="togglePowerUp('shield')"></div>
                </div>
                <div class="toggle-option powerup-option" style="margin-top: 0.5rem;">
                    <div class="powerup-info">
                        <div class="powerup-icon icon-wide-platform"></div>
                        <div class="powerup-text">
                            <span class="toggle-label">Wide Platform</span>
                            <span class="powerup-desc">Platform gets 30% wider for 12 seconds</span>
                        </div>
                    </div>
                    <div class="toggle-switch on" id="widePlatformToggle" onclick="togglePowerUp('widePlatform')"></div>
                </div>
                <div class="toggle-option powerup-option" style="margin-top: 0.5rem;">
                    <div class="powerup-info">
                        <div class="powerup-icon icon-magnet"></div>
                        <div class="powerup-text">
                            <span class="toggle-label">Magnet</span>
                            <span class="powerup-desc">Ball grips platform &amp; resists black holes for 12 sec</span>
                        </div>
                    </div>
                    <div class="toggle-switch on" id="magnetToggle" onclick="togglePowerUp('magnet')"></div>
                </div>
                <div class="toggle-option powerup-option" style="margin-top: 0.5rem;">
                    <div class="powerup-info">
                        <div class="powerup-icon icon-shrink-ball"></div>
                        <div class="powerup-text">
                            <span class="toggle-label">Shrink Ball</span>
                            <span class="powerup-desc">Ball shrinks 50% permanently (counters Big Ballz)</span>
                        </div>
                    </div>
                    <div class="toggle-switch on" id="shrinkBallToggle" onclick="togglePowerUp('shrinkBall')"></div>
                </div>
                <div class="toggle-option powerup-option" style="margin-top: 0.5rem;">
                    <div class="powerup-info">
                        <div class="powerup-icon icon-big-ballz"></div>
                        <div class="powerup-text">
                            <span class="toggle-label">Big Ballz</span>
                            <span class="powerup-desc">Ball grows 40% permanently (counters Shrink Ball)</span>
                        </div>
                    </div>
                    <div class="toggle-switch on" id="bigBallzToggle" onclick="togglePowerUp('bigBallz')"></div>
                </div>
                <div class="toggle-option powerup-option" style="margin-top: 0.5rem;">
                    <div class="powerup-info">
                        <div class="powerup-icon icon-time-freeze"></div>
                        <div class="powerup-text">
                            <span class="toggle-label">Time Freeze</span>
                            <span class="powerup-desc">Black holes stop moving for 12 seconds</span>
                        </div>
                    </div>
                    <div class="toggle-switch on" id="timeFreezeToggle" onclick="togglePowerUp('timeFreeze')"></div>
                </div>
                <div class="toggle-option powerup-option" style="margin-top: 0.5rem;">
                    <div class="powerup-info">
                        <div class="powerup-icon icon-extra-ball"></div>
                        <div class="powerup-text">
                            <span class="toggle-label">Extra Ball</span>
                            <span class="powerup-desc">Adds a second ball (max 2 balls)</span>
                        </div>
                    </div>
                    <div class="toggle-switch on" id="extraBallToggle" onclick="togglePowerUp('extraBall')"></div>
                </div>
                <div class="toggle-option powerup-option" style="margin-top: 0.5rem;">
                    <div class="powerup-info">
                        <div class="powerup-icon icon-random"></div>
                        <div class="powerup-text">
                            <span class="toggle-label">Random</span>
                            <span class="powerup-desc">Activates a random power-up or power-down</span>
                        </div>
                    </div>
                    <div class="toggle-switch on" id="randomToggle" onclick="togglePowerUp('random')"></div>
                </div>
            </div>

            <hr class="settings-divider">

            <div class="setting-group">
                <h3>Power-Downs</h3>
                <div class="toggle-option powerup-option powerdown-option">
                    <div class="powerup-info">
                        <div class="powerup-icon icon-narrow-platform"></div>
                        <div class="powerup-text">
                            <span class="toggle-label powerdown-label">Narrow Platform</span>
                            <span class="powerup-desc">Platform shrinks 30% for 12 seconds</span>
                        </div>
                    </div>
                    <div class="toggle-switch on" id="narrowPlatformToggle" onclick="togglePowerUp('narrowPlatform')"></div>
                </div>
                <div class="toggle-option powerup-option powerdown-option" style="margin-top: 0.5rem;">
                    <div class="powerup-info">
                        <div class="powerup-icon icon-ice-mode"></div>
                        <div class="powerup-text">
                            <span class="toggle-label powerdown-label">Ice Mode</span>
                            <span class="powerup-desc">Platform becomes super slippery for 12 seconds</span>
                        </div>
                    </div>
                    <div class="toggle-switch on" id="iceModeToggle" onclick="togglePowerUp('iceMode')"></div>
                </div>
                <div class="toggle-option powerup-option powerdown-option" style="margin-top: 0.5rem;">
                    <div class="powerup-info">
                        <div class="powerup-icon icon-blinking-eye"></div>
                        <div class="powerup-text">
                            <span class="toggle-label powerdown-label">Blinking Eye</span>
                            <span class="powerup-desc">Ball blinks invisible every other second for 12 sec</span>
                        </div>
                    </div>
                    <div class="toggle-switch on" id="blinkingEyeToggle" onclick="togglePowerUp('blinkingEye')"></div>
                </div>
                <div class="toggle-option powerup-option powerdown-option" style="margin-top: 0.5rem;">
                    <div class="powerup-info">
                        <div class="powerup-icon icon-earthquake"></div>
                        <div class="powerup-text">
                            <span class="toggle-label powerdown-label">Earthquake</span>
                            <span class="powerup-desc">Platform shakes randomly for 12 seconds</span>
                        </div>
                    </div>
                    <div class="toggle-switch on" id="earthquakeToggle" onclick="togglePowerUp('earthquake')"></div>
                </div>
            </div>

            <button class="settings-close" onclick="closeSettings()">SAVE & CLOSE</button>
        </div>
    </div>

    <h1>BALANCE BALL</h1>
    
    <div class="game-container">
        <canvas id="gameCanvas" width="1000" height="700"></canvas>
        
        <div class="game-over" id="gameOver">
            <h2>GAME OVER!</h2>
            <p id="gameOverReason">The ball fell off the platform!</p>
            <p>Your score: <span id="finalScore">0</span> points</p>
            
            <!-- Score Submission Section -->
            <div id="submitScoreSection" class="submit-score-section" style="display: none;">
                <p id="submitRankInfo" class="rank-info"></p>
                <div class="submit-form">
                    <input type="text" id="playerName" placeholder="Your name (max 20)" maxlength="20">
                    <input type="text" id="playerMessage" placeholder="Message (optional, max 30)" maxlength="30">
                    <button id="submitScoreBtn" onclick="handleScoreSubmit()">Submit Score</button>
                </div>
            </div>
            
            <!-- Mini Leaderboard (Top 3) -->
            <div class="mini-leaderboard">
                <h3>üèÜ Top 3</h3>
                <table class="leaderboard-table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Name</th>
                            <th>Score</th>
                            <th>Date</th>
                            <th>Message</th>
                        </tr>
                    </thead>
                    <tbody id="miniLeaderboardBody">
                        <tr><td colspan="5" class="loading">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
            
            <button class="restart-btn" onclick="restartGame()">PLAY AGAIN</button>
            <p class="enter-hint">or press SPACE</p>
        </div>
    </div>

    <script type="module" src="js/main.js"></script>
</body>
</html>
